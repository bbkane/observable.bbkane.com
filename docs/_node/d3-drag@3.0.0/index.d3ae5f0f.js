import{dispatch as W}from"../d3-dispatch@3.0.1/index.be49ca5f.js";import{select as E,pointer as Y}from"../d3-selection@3.0.0/index.13204b25.js";const Z={passive:!1},y={capture:!0,passive:!1};function M(t){t.stopImmediatePropagation()}function p(t){t.preventDefault(),t.stopImmediatePropagation()}function q(t){var a=t.document.documentElement,i=E(t).on("dragstart.drag",p,y);"onselectstart"in a?i.on("selectstart.drag",p,y):(a.__noselect=a.style.MozUserSelect,a.style.MozUserSelect="none")}function A(t,a){var i=t.document.documentElement,s=E(t).on("dragstart.drag",null);a&&(s.on("click.drag",p,y),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in i?s.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}var k=t=>()=>t;function P(t,{sourceEvent:a,subject:i,target:s,identifier:f,active:m,x:h,y:x,dx:w,dy:v,dispatch:g}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:a,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},identifier:{value:f,enumerable:!0,configurable:!0},active:{value:m,enumerable:!0,configurable:!0},x:{value:h,enumerable:!0,configurable:!0},y:{value:x,enumerable:!0,configurable:!0},dx:{value:w,enumerable:!0,configurable:!0},dy:{value:v,enumerable:!0,configurable:!0},_:{value:g}})}P.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function J(t){return!t.ctrlKey&&!t.button}function L(){return this.parentNode}function Q(t,a){return a??{x:t.x,y:t.y}}function R(){return navigator.maxTouchPoints||"ontouchstart"in this}function C(){var t=J,a=L,i=Q,s=R,f={},m=W("start","drag","end"),h=0,x,w,v,g,j=0;function o(e){e.on("mousedown.drag",B).filter(s).on("touchstart.drag",H).on("touchmove.drag",K,Z).on("touchend.drag touchcancel.drag",N).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function B(e,n){if(!(g||!t.call(this,e,n))){var r=S(this,a.call(this,e,n),e,n,"mouse");r&&(E(e.view).on("mousemove.drag",F,y).on("mouseup.drag",G,y),q(e.view),M(e),v=!1,x=e.clientX,w=e.clientY,r("start",e))}}function F(e){if(p(e),!v){var n=e.clientX-x,r=e.clientY-w;v=n*n+r*r>j}f.mouse("drag",e)}function G(e){E(e.view).on("mousemove.drag mouseup.drag",null),A(e.view,v),p(e),f.mouse("end",e)}function H(e,n){if(t.call(this,e,n)){var r=e.changedTouches,u=a.call(this,e,n),c=r.length,d,b;for(d=0;d<c;++d)(b=S(this,u,e,n,r[d].identifier,r[d]))&&(M(e),b("start",e,r[d]))}}function K(e){var n=e.changedTouches,r=n.length,u,c;for(u=0;u<r;++u)(c=f[n[u].identifier])&&(p(e),c("drag",e,n[u]))}function N(e){var n=e.changedTouches,r=n.length,u,c;for(g&&clearTimeout(g),g=setTimeout(function(){g=null},500),u=0;u<r;++u)(c=f[n[u].identifier])&&(M(e),c("end",e,n[u]))}function S(e,n,r,u,c,d){var b=m.copy(),l=Y(d||r,n),U,D,_;if((_=i.call(e,new P("beforestart",{sourceEvent:r,target:o,identifier:c,active:h,x:l[0],y:l[1],dx:0,dy:0,dispatch:b}),u))!=null)return U=_.x-l[0]||0,D=_.y-l[1]||0,function O(T,I,V){var X=l,z;switch(T){case"start":f[c]=O,z=h++;break;case"end":delete f[c],--h;case"drag":l=Y(V||I,n),z=h;break}b.call(T,e,new P(T,{sourceEvent:I,subject:_,target:o,identifier:c,active:z,x:l[0]+U,y:l[1]+D,dx:l[0]-X[0],dy:l[1]-X[1],dispatch:b}),u)}}return o.filter=function(e){return arguments.length?(t=typeof e=="function"?e:k(!!e),o):t},o.container=function(e){return arguments.length?(a=typeof e=="function"?e:k(e),o):a},o.subject=function(e){return arguments.length?(i=typeof e=="function"?e:k(e),o):i},o.touchable=function(e){return arguments.length?(s=typeof e=="function"?e:k(!!e),o):s},o.on=function(){var e=m.on.apply(m,arguments);return e===m?o:e},o.clickDistance=function(e){return arguments.length?(j=(e=+e)*e,o):Math.sqrt(j)},o}export{C as drag,q as dragDisable,A as dragEnable};
