import{thresholdSturges as V,extent as B,ticks as C,nice as Y,max as D,blur2 as _}from"../d3-array@3.2.4/index.f89e3560.js";var G=Array.prototype,O=G.slice;function H(n,e){return n-e}function J(n){for(var e=0,f=n.length,g=n[f-1][1]*n[0][0]-n[f-1][0]*n[0][1];++e<f;)g+=n[e-1][1]*n[e][0]-n[e-1][0]*n[e][1];return g}var L=n=>()=>n;function K(n,e){for(var f=-1,g=e.length,h;++f<g;)if(h=Q(n,e[f]))return h;return 0}function Q(n,e){for(var f=e[0],g=e[1],h=-1,E=0,y=n.length,N=y-1;E<y;N=E++){var p=n[E],r=p[0],o=p[1],c=n[N],i=c[0],s=c[1];if(R(p,c,e))return 0;o>g!=s>g&&f<(i-r)*(g-o)/(s-o)+r&&(h=-h)}return h}function R(n,e,f){var g;return T(n,e,f)&&W(n[g=+(n[0]===e[0])],f[g],e[g])}function T(n,e,f){return(e[0]-n[0])*(f[1]-n[1])===(f[0]-n[0])*(e[1]-n[1])}function W(n,e,f){return n<=e&&e<=f||f<=e&&e<=n}function X(){}var S=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function k(){var n=1,e=1,f=V,g=p;function h(r){var o=f(r);if(Array.isArray(o))o=o.slice().sort(H);else{const c=B(r,Z);for(o=C(...Y(c[0],c[1],o),o);o[o.length-1]>=c[1];)o.pop();for(;o[1]<c[0];)o.shift()}return o.map(c=>E(r,c))}function E(r,o){const c=o==null?NaN:+o;if(isNaN(c))throw new Error(`invalid value: ${o}`);var i=[],s=[];return y(r,c,function(a){g(a,r,c),J(a)>0?i.push([a]):s.push(a)}),s.forEach(function(a){for(var v=0,x=i.length,d;v<x;++v)if(K((d=i[v])[0],a)!==-1){d.push(a);return}}),{type:"MultiPolygon",value:o,coordinates:i}}function y(r,o,c){var i=new Array,s=new Array,a,v,x,d,t,w;for(a=v=-1,d=P(r[0],o),S[d<<1].forEach(l);++a<n-1;)x=d,d=P(r[a+1],o),S[x|d<<1].forEach(l);for(S[d<<0].forEach(l);++v<e-1;){for(a=-1,d=P(r[v*n+n],o),t=P(r[v*n],o),S[d<<1|t<<2].forEach(l);++a<n-1;)x=d,d=P(r[v*n+n+a+1],o),w=t,t=P(r[v*n+a+1],o),S[x|d<<1|t<<2|w<<3].forEach(l);S[d|t<<3].forEach(l)}for(a=-1,t=r[v*n]>=o,S[t<<2].forEach(l);++a<n-1;)w=t,t=P(r[v*n+a+1],o),S[t<<2|w<<3].forEach(l);S[t<<3].forEach(l);function l(b){var A=[b[0][0]+a,b[0][1]+v],m=[b[1][0]+a,b[1][1]+v],z=N(A),F=N(m),u,M;(u=s[z])?(M=i[F])?(delete s[u.end],delete i[M.start],u===M?(u.ring.push(m),c(u.ring)):i[u.start]=s[M.end]={start:u.start,end:M.end,ring:u.ring.concat(M.ring)}):(delete s[u.end],u.ring.push(m),s[u.end=F]=u):(u=i[F])?(M=s[z])?(delete i[u.start],delete s[M.end],u===M?(u.ring.push(m),c(u.ring)):i[M.start]=s[u.end]={start:M.start,end:u.end,ring:M.ring.concat(u.ring)}):(delete i[u.start],u.ring.unshift(A),i[u.start=z]=u):i[z]=s[F]={start:z,end:F,ring:[A,m]}}}function N(r){return r[0]*2+r[1]*(n+1)*4}function p(r,o,c){r.forEach(function(i){var s=i[0],a=i[1],v=s|0,x=a|0,d=q(o[x*n+v]);s>0&&s<n&&v===s&&(i[0]=U(s,q(o[x*n+v-1]),d,c)),a>0&&a<e&&x===a&&(i[1]=U(a,q(o[(x-1)*n+v]),d,c))})}return h.contour=E,h.size=function(r){if(!arguments.length)return[n,e];var o=Math.floor(r[0]),c=Math.floor(r[1]);if(!(o>=0&&c>=0))throw new Error("invalid size");return n=o,e=c,h},h.thresholds=function(r){return arguments.length?(f=typeof r=="function"?r:Array.isArray(r)?L(O.call(r)):L(r),h):f},h.smooth=function(r){return arguments.length?(g=r?p:X,h):g===p},h}function Z(n){return isFinite(n)?n:NaN}function P(n,e){return n==null?!1:+n>=e}function q(n){return n==null||isNaN(n=+n)?-1/0:n}function U(n,e,f,g){const h=g-e,E=f-e,y=isFinite(h)||isFinite(E)?h/E:Math.sign(h)/Math.sign(E);return isNaN(y)?n:n+y-.5}function I(n){return n[0]}function nn(n){return n[1]}function tn(){return 1}function rn(){var n=I,e=nn,f=tn,g=960,h=500,E=20,y=2,N=E*3,p=g+N*2>>y,r=h+N*2>>y,o=L(20);function c(t){var w=new Float32Array(p*r),l=Math.pow(2,-y),b=-1;for(const j of t){var A=(n(j,++b,t)+N)*l,m=(e(j,b,t)+N)*l,z=+f(j,b,t);if(z&&A>=0&&A<p&&m>=0&&m<r){var F=Math.floor(A),u=Math.floor(m),M=A-F-.5,$=m-u-.5;w[F+u*p]+=(1-M)*(1-$)*z,w[F+1+u*p]+=M*(1-$)*z,w[F+1+(u+1)*p]+=M*$*z,w[F+(u+1)*p]+=(1-M)*$*z}}return _({data:w,width:p,height:r},E*l),w}function i(t){var w=c(t),l=o(w),b=Math.pow(2,2*y);return Array.isArray(l)||(l=C(Number.MIN_VALUE,D(w)/b,l)),k().size([p,r]).thresholds(l.map(A=>A*b))(w).map((A,m)=>(A.value=+l[m],s(A)))}i.contours=function(t){var w=c(t),l=k().size([p,r]),b=Math.pow(2,2*y),A=m=>{m=+m;var z=s(l.contour(w,m*b));return z.value=m,z};return Object.defineProperty(A,"max",{get:()=>D(w)/b}),A};function s(t){return t.coordinates.forEach(a),t}function a(t){t.forEach(v)}function v(t){t.forEach(x)}function x(t){t[0]=t[0]*Math.pow(2,y)-N,t[1]=t[1]*Math.pow(2,y)-N}function d(){return N=E*3,p=g+N*2>>y,r=h+N*2>>y,i}return i.x=function(t){return arguments.length?(n=typeof t=="function"?t:L(+t),i):n},i.y=function(t){return arguments.length?(e=typeof t=="function"?t:L(+t),i):e},i.weight=function(t){return arguments.length?(f=typeof t=="function"?t:L(+t),i):f},i.size=function(t){if(!arguments.length)return[g,h];var w=+t[0],l=+t[1];if(!(w>=0&&l>=0))throw new Error("invalid size");return g=w,h=l,d()},i.cellSize=function(t){if(!arguments.length)return 1<<y;if(!((t=+t)>=1))throw new Error("invalid cell size");return y=Math.floor(Math.log(t)/Math.LN2),d()},i.thresholds=function(t){return arguments.length?(o=typeof t=="function"?t:Array.isArray(t)?L(O.call(t)):L(t),i):o},i.bandwidth=function(t){if(!arguments.length)return Math.sqrt(E*(E+1));if(!((t=+t)>=0))throw new Error("invalid bandwidth");return E=(Math.sqrt(4*t*t+1)-1)/2,d()},i}export{rn as contourDensity,k as contours};
