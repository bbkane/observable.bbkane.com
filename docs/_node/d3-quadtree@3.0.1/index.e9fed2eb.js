function M(n){const t=+this._x.call(null,n),r=+this._y.call(null,n);return k(this.cover(t,r),t,r,n)}function k(n,t,r,e){if(isNaN(t)||isNaN(r))return n;var i,h=n._root,s={data:e},u=n._x0,o=n._y0,a=n._x1,l=n._y1,_,f,x,y,w,c,v,g;if(!h)return n._root=s,n;for(;h.length;)if((w=t>=(_=(u+a)/2))?u=_:a=_,(c=r>=(f=(o+l)/2))?o=f:l=f,i=h,!(h=h[v=c<<1|w]))return i[v]=s,n;if(x=+n._x.call(null,h.data),y=+n._y.call(null,h.data),t===x&&r===y)return s.next=h,i?i[v]=s:n._root=s,n;do i=i?i[v]=new Array(4):n._root=new Array(4),(w=t>=(_=(u+a)/2))?u=_:a=_,(c=r>=(f=(o+l)/2))?o=f:l=f;while((v=c<<1|w)===(g=(y>=f)<<1|x>=_));return i[g]=h,i[v]=s,n}function z(n){var t,r,e=n.length,i,h,s=new Array(e),u=new Array(e),o=1/0,a=1/0,l=-1/0,_=-1/0;for(r=0;r<e;++r)isNaN(i=+this._x.call(null,t=n[r]))||isNaN(h=+this._y.call(null,t))||(s[r]=i,u[r]=h,i<o&&(o=i),i>l&&(l=i),h<a&&(a=h),h>_&&(_=h));if(o>l||a>_)return this;for(this.cover(o,a).cover(l,_),r=0;r<e;++r)k(this,s[r],u[r],n[r]);return this}function I(n,t){if(isNaN(n=+n)||isNaN(t=+t))return this;var r=this._x0,e=this._y0,i=this._x1,h=this._y1;if(isNaN(r))i=(r=Math.floor(n))+1,h=(e=Math.floor(t))+1;else{for(var s=i-r||1,u=this._root,o,a;r>n||n>=i||e>t||t>=h;)switch(a=(t<e)<<1|n<r,o=new Array(4),o[a]=u,u=o,s*=2,a){case 0:i=r+s,h=e+s;break;case 1:r=i-s,h=e+s;break;case 2:i=r+s,e=h-s;break;case 3:r=i-s,e=h-s;break}this._root&&this._root.length&&(this._root=u)}return this._x0=r,this._y0=e,this._x1=i,this._y1=h,this}function j(){var n=[];return this.visit(function(t){if(!t.length)do n.push(t.data);while(t=t.next)}),n}function B(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function d(n,t,r,e,i){this.node=n,this.x0=t,this.y0=r,this.x1=e,this.y1=i}function C(n,t,r){var e,i=this._x0,h=this._y0,s,u,o,a,l=this._x1,_=this._y1,f=[],x=this._root,y,w;for(x&&f.push(new d(x,i,h,l,_)),r==null?r=1/0:(i=n-r,h=t-r,l=n+r,_=t+r,r*=r);y=f.pop();)if(!(!(x=y.node)||(s=y.x0)>l||(u=y.y0)>_||(o=y.x1)<i||(a=y.y1)<h))if(x.length){var c=(s+o)/2,v=(u+a)/2;f.push(new d(x[3],c,v,o,a),new d(x[2],s,v,c,a),new d(x[1],c,u,o,v),new d(x[0],s,u,c,v)),(w=(t>=v)<<1|n>=c)&&(y=f[f.length-1],f[f.length-1]=f[f.length-1-w],f[f.length-1-w]=y)}else{var g=n-+this._x.call(null,x.data),$=t-+this._y.call(null,x.data),m=g*g+$*$;if(m<r){var N=Math.sqrt(r=m);i=n-N,h=t-N,l=n+N,_=t+N,e=x.data}}return e}function D(n){if(isNaN(l=+this._x.call(null,n))||isNaN(_=+this._y.call(null,n)))return this;var t,r=this._root,e,i,h,s=this._x0,u=this._y0,o=this._x1,a=this._y1,l,_,f,x,y,w,c,v;if(!r)return this;if(r.length)for(;;){if((y=l>=(f=(s+o)/2))?s=f:o=f,(w=_>=(x=(u+a)/2))?u=x:a=x,t=r,!(r=r[c=w<<1|y]))return this;if(!r.length)break;(t[c+1&3]||t[c+2&3]||t[c+3&3])&&(e=t,v=c)}for(;r.data!==n;)if(i=r,!(r=r.next))return this;return(h=r.next)&&delete r.next,i?(h?i.next=h:delete i.next,this):t?(h?t[c]=h:delete t[c],(r=t[0]||t[1]||t[2]||t[3])&&r===(t[3]||t[2]||t[1]||t[0])&&!r.length&&(e?e[v]=r:this._root=r),this):(this._root=h,this)}function E(n){for(var t=0,r=n.length;t<r;++t)this.remove(n[t]);return this}function F(){return this._root}function G(){var n=0;return this.visit(function(t){if(!t.length)do++n;while(t=t.next)}),n}function H(n){var t=[],r,e=this._root,i,h,s,u,o;for(e&&t.push(new d(e,this._x0,this._y0,this._x1,this._y1));r=t.pop();)if(!n(e=r.node,h=r.x0,s=r.y0,u=r.x1,o=r.y1)&&e.length){var a=(h+u)/2,l=(s+o)/2;(i=e[3])&&t.push(new d(i,a,l,u,o)),(i=e[2])&&t.push(new d(i,h,l,a,o)),(i=e[1])&&t.push(new d(i,a,s,u,l)),(i=e[0])&&t.push(new d(i,h,s,a,l))}return this}function J(n){var t=[],r=[],e;for(this._root&&t.push(new d(this._root,this._x0,this._y0,this._x1,this._y1));e=t.pop();){var i=e.node;if(i.length){var h,s=e.x0,u=e.y0,o=e.x1,a=e.y1,l=(s+o)/2,_=(u+a)/2;(h=i[0])&&t.push(new d(h,s,u,l,_)),(h=i[1])&&t.push(new d(h,l,u,o,_)),(h=i[2])&&t.push(new d(h,s,_,l,a)),(h=i[3])&&t.push(new d(h,l,_,o,a))}r.push(e)}for(;e=r.pop();)n(e.node,e.x0,e.y0,e.x1,e.y1);return this}function K(n){return n[0]}function L(n){return arguments.length?(this._x=n,this):this._x}function O(n){return n[1]}function P(n){return arguments.length?(this._y=n,this):this._y}function b(n,t,r){var e=new A(t??K,r??O,NaN,NaN,NaN,NaN);return n==null?e:e.addAll(n)}function A(n,t,r,e,i,h){this._x=n,this._y=t,this._x0=r,this._y0=e,this._x1=i,this._y1=h,this._root=void 0}function q(n){for(var t={data:n.data},r=t;n=n.next;)r=r.next={data:n.data};return t}var p=b.prototype=A.prototype;p.copy=function(){var n=new A(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,r,e;if(!t)return n;if(!t.length)return n._root=q(t),n;for(r=[{source:t,target:n._root=new Array(4)}];t=r.pop();)for(var i=0;i<4;++i)(e=t.source[i])&&(e.length?r.push({source:e,target:t.target[i]=new Array(4)}):t.target[i]=q(e));return n},p.add=M,p.addAll=z,p.cover=I,p.data=j,p.extent=B,p.find=C,p.remove=D,p.removeAll=E,p.root=F,p.size=G,p.visit=H,p.visitAfter=J,p.x=L,p.y=P;export{b as quadtree};
